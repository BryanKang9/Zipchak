<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.mapper.ChatMessageMapper">
    <select id="getChatMessage" parameterType="int" resultType="cmdto">
        SELECT * from cm
        where cm.cr_num=#{cr_num} order by cm_wdate
    </select>
    <insert id="insertChatMessage" parameterType="cmdto" useGeneratedKeys="true" keyProperty="cm_num" keyColumn="cm_num">
        insert into cm values (null, #{cr_num},#{sender},#{msg},0,now(3))
    </insert>
    <select id="getMsg" parameterType="int" resultType="cmdto">
        select * from cm where cm_num=#{cm_num}
    </select>
    <select id="getSender" parameterType="int" resultType="int">
        select sender from cm where cr_num=#{cr_num} order by cm_wdate desc limit 1
    </select>
    <update id="updateRead" parameterType="map">
        update cm set is_read=1 where cr_num=#{cr_num} and sender=#{sender}
    </update>
</mapper>